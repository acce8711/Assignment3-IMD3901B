<!DOCTYPE html>
<html lang="en">
<head>
    <title>Pottery VR</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/styles.css"/>

    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.3.3/dist/aframe-environment-component.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-particle-system-component@1.2.0/dist/aframe-particle-system-component.min.js"></script>

    <script src="scripts/modified-look-controls.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="scripts/Constants.js"></script>
    <script src="scripts/game-manager.js"></script>
    <script src="scripts/desktop-plane-movement.js"></script>
    <script src="scripts/element-generator.js"></script>
    <script src="scripts/ring-obstacle.js"></script>
    <script src="scripts/plane-collider.js"></script>
    <script src="scripts/delete-ring.js"></script>
    <script src="scripts/plane-movement.js"></script>
    <script src="scripts/cloud-generator.js"></script>
    <script src="scripts/clouds.js"></script>
    <script src="scripts/delete-cloud.js"></script>

    <script>

            AFRAME.registerComponent('hi', {
            init: function () {
                Context_AF = this;
                Context_AF.camera = document.querySelector("#camera");
                Context_AF.plane = document.querySelector("#plane");
                Context_AF.prevRotationX = Context_AF.camera.object3D.rotation.x;
                Context_AF.yPosFactor = 0;
                Context_AF.score = 0;

                //check camera rotation every x seconds and emit an event if the rotation has changed
                // Context_AF.intervalId = setInterval(function() {
                //         const rotation = Context_AF.camera.object3D.rotation.x;
                //         if(Math.abs(Context_AF.prevRotationX - rotation) >= 0.05)
                //         {
                //             Context_AF.prevRotationX = rotation;
                //             //update the amount the camera y position is being updated each frame
                //             Context_AF.yPosFactor = (0.05 * Context_AF.prevRotationX);
                //             const event = new CustomEvent("xRotation", {
                //                 detail: {
                //                     planeXRotation: Context_AF.prevRotationX,
                //                     planeYPosFactor: Context_AF.yPosFactor
                //                 }
                //             });
                //             Context_AF.camera.dispatchEvent(event);
                //         }
                //     }, 200)

                    
                        

                
            },

            tick: function() {
                const rotation = Context_AF.camera.object3D.rotation.x;
                            Context_AF.prevRotationX = rotation;
                            //update the amount the camera y position is being updated each frame
                            Context_AF.yPosFactor = (0.05 * Context_AF.prevRotationX);
                            const event = new CustomEvent("xRotation", {
                                detail: {
                                    planeXRotation: Context_AF.prevRotationX,
                                    planeYPosFactor: Context_AF.yPosFactor
                                }
                            });
                            Context_AF.camera.dispatchEvent(event);
                Context_AF.camera.object3D.position.y = Context_AF.camera.object3D.position.y + Context_AF.yPosFactor;
            },

            remove: function() {
                clearInterval(Context_AF.intervalId);
            }
            });

            
    </script>
    

</head>
<body>

    <!-- UI used throughout the experience -->
    <div id="waitingUI" class="ui-elements activeUI" style="display: block;">
        <p>Waiting for the other player to join</p>
    </div>

    <div id="modeSelectionUI" class="ui-elements" style="display: none;">
        <p>Selecting the mode</p>
        <div id="modeSelectionButtons" style="display: none;">
            <button id="competitiveModeButton">Competitive</button>
            <button id="collaborativeModeButton">Collaborative</button>
        </div> 
    </div>

    <div id="instructionsUI" class="ui-elements" style="display: none;">
        <p>Displaying the instructions</p>
        <button id="continueButton">Ready to start playing</button>
    </div>

    <div id="playingUI" class="ui-elements" style="display: none;">
        <p>Playing the game</p>
        <p id="timer">Timer: </p>
        <p id="score">Score:</p>
        <p id="opponentScore" style="display: none;">My score: </p>
        <div id="horizontalControl" class="ui-elements" style="display: none;">
            <button id="left">Left</button>
            <button id="right">Right</button>
        </div>
        </div>
    </div>


    

    <a-scene  obb-collider="showColliders: false" id="scene">
        <!-- loading in the assets -->
        <a-assets timeOut="10000">
            <img id="sky_img" src="assets/textures/sky.png" crossorigin="anonymous">
            <!-- <audio id="room_ambience" src="assets/sounds/room-ambience.mp3" preload="auto" crossorigin="anonymous"></audio>
            <audio id="clay_place" src="assets/sounds/clay-slap.mp3" preload="auto" crossorigin="anonymous"></audio>
            <audio id="button_sound" src="assets/sounds/button-press.mp3" preload="auto" crossorigin="anonymous"></audio>
            <audio id="wheel_sound" src="assets/sounds/wheel-spin-cut.mp3" preload="auto" crossorigin="anonymous"></audio>
            <audio id="pickUp_sound" src="assets/sounds/pick-up.mp3" preload="auto" crossorigin="anonymous"></audio>
            <audio id="smash_sound" src="assets/sounds/clay-smash2.mp3" preload="auto" crossorigin="anonymous"></audio>
            <a-asset-item id="room_model" response-type="arraybuffer" src="assets/models/room.glb"></a-asset-item>
            <a-asset-item id="scene_model" response-type="arraybuffer" src="assets/models/furniture.glb"></a-asset-item>
            <a-asset-item id="clay_model" response-type="arraybuffer" src="assets/models/clay.glb"></a-asset-item>-->
            <a-asset-item id="paper_plane" response-type="arraybuffer" src="assets/models/paper_plane.glb"></a-asset-item> 
            <a-asset-item id="cloud_1_gltf" response-type="arraybuffer" src="assets/models/cloud_1.glb"></a-asset-item> 
        </a-assets>

        <!-- <a-entity environment="fog: 0.85; ground:none; skyType:gradient; horizonColor:
        #ffb37d
        ; skyColor:#c000f5"></a-entity>

        <a-entity geometry="primitive: sphere; radius: 40;"
                  material="shader: flat; side: back; src:#sky_img; "></a-entity> -->
                  <a-sky src="#sky_img"></a-sky>
        <a-entity light="type:directional; color:#ffdd80; intensity: 0.8"
                  position="-0.5 1 1"></a-entity>
        <a-entity light="type:ambient; color:#fbc5fc; intensity: 0.8"></a-entity>

        <!-- camera -->
        <a-entity id="camera" 
                  camera
                  wasd-controls
                  look-controls
                  position="0 1.6 0">
            <a-entity id="cursor" 
                      cursor="rayOrigin:mouse;"
                      raycaster="far:20; interval:200; objects:.interactive">
            </a-entity>
        </a-entity>

        <a-entity id="plane"
                  rotation="-20 -180 0" 
                  position="0 0 0"
                  scale="0.1 0.1 0.1" 
                  gltf-model="#paper_plane">
        </a-entity>

        <a-entity game-manager></a-entity>
        <a-entity id="game"></a-entity>
        <!-- <a-entity element-generator id="elementGenerator"></a-entity> -->

        <!-- ring removal collider -->
        <a-entity geometry="primitive: box"
                  scale="40 40 0.2"
                  position="0 0 10"
                  obb-collider
                  delete-ring>
        </a-entity>

        <a-entity geometry="primitive: box"
                  scale="40 40 0.2"
                  position="0 0 11"
                  obb-collider
                  delete-cloud>
        </a-entity>

        <!-- <a-entity rotation="0 0 90" position="10 0 -10">
            <a-entity id="particles"  particle-system="positionSpread: 50 0 0; size: 7; preset: default;  maxAge: 4; particleCount: 50; accelerationValue: 0, 2, 0; accelerationSpread: 0 0 0; velocityValue: 0 15 0; velocitySpread:0 0 0; texture: assets/textures/wind.png"></a-entity>
            <a-entity id="particles"  particle-system="positionSpread: 50 0 0; size: 1; preset: default;  maxAge: 4; particleCount: 50; accelerationValue: 0, 2, 0; accelerationSpread: 0 0 0; velocityValue: 0 15 0; velocitySpread:0 0 0; texture: assets/textures/dotGlow.png"></a-entity>
        </a-entity> -->
        
        <a-entity rotation="0 0 90" position="11 -2 -10" id="particlesRightSide"  particle-system="enabled: false; opacity: 0.7, 0; color:#FFFFFF;  size: 0.5; preset: default;  maxAge: 0.7; particleCount: 20; accelerationValue: 0, 10, 0; accelerationSpread: 10 0 0; velocityValue: 2 2 0; velocitySpread:10 0 0; texture: assets/textures/dot.png"></a-entity>
        <a-entity rotation="0 0 -90" position="-11 -2 -10" id="particlesLeftSide"  particle-system="enabled: false; opacity: 0.7, 0; color:#FFFFFF;  size: 0.5; preset: default;  maxAge: 0.7; particleCount: 20; accelerationValue: 0, 10, 0; accelerationSpread: 10 0 0; velocityValue: 2 2 0; velocitySpread:10 0 0; texture: assets/textures/dot.png"></a-entity>

       
    </a-scene>
</body>
</html>